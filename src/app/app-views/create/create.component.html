<!-- <mat-icon>room</mat-icon> pour icon arret-->
<mat-stepper [orientation]="innerWidth<600?'vertical':'horizontal'" linear="false">
  <mat-step [stepControl]="firstFormGroup" errorMessage="Info du défi non remplies en totalité">
    <form [formGroup]="firstFormGroup" novalidate>
      <ng-template matStepLabel>Tu veux créer un défi ? C'est parti !</ng-template>
      <div class="step-container">
        <!-- Titre du défi -->
        <div class="form-items">
          <p>Tu dois donner un titre à ton défi !</p>
          <mat-form-field appearance="outline">
            <mat-label>Titre du défi</mat-label>
            <input matInput placeholder="" formControlName="titre" required>
            <mat-error *ngIf="checkError('titre', 'required')">Le titre doit être renseigné</mat-error>
            <mat-error *ngIf="checkError('titre', 'maxlength')">Le titre est trop
              longue {{firstFormGroup.controls['titre'].value.length}}/45
            </mat-error>
            <mat-error *ngIf="checkError('titre', 'minlength')">Le titre est trop courte
              de {{5 - firstFormGroup.controls['titre'].value.length}}</mat-error>
          </mat-form-field>
        </div>

        <!-- Description -->
        <div class="form-items">
          <p>Décris-nous brievement ton défi ?</p>
          <mat-form-field appearance="outline">
            <mat-label>Mini description du défi</mat-label>
            <input matInput placeholder="" formControlName="minidescription" required/>
            <mat-error *ngIf="checkError('minidescription', 'required')">La description doit être renseignée</mat-error>
            <mat-error *ngIf="checkError('minidescription', 'maxlength')">La description est trop
              longue {{firstFormGroup.controls['minidescription'].value.length}}/128
            </mat-error>
            <mat-error *ngIf="checkError('minidescription', 'minlength')">La description est trop courte
              de {{10 - firstFormGroup.controls['minidescription'].value.length}}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-items">
          <p>Tu peut dévlopper un peut plus ici.</p>
          <mat-form-field appearance="outline">
            <mat-label>Description complete du défi</mat-label>
            <textarea matInput placeholder="" formControlName="description" rows="4" required></textarea>
            <mat-error *ngIf="checkError('description', 'required')">La description doit être renseignée</mat-error>
            <mat-error *ngIf="checkError('description', 'maxlength')">La description est trop
              longue {{firstFormGroup.controls['description'].value.length}}/1024
            </mat-error>
            <mat-error *ngIf="checkError('description', 'minlength')">La description est trop courte
              de {{50 - firstFormGroup.controls['description'].value.length}}</mat-error>
          </mat-form-field>
        </div>
        <div class="split-container">
          <div class="form-items">
            <!-- Arret -->
            <p>Choisis l'arrêt dans la Métropole qui servira de point de départ au visiteur pour commencer ton défi.</p>
            <mat-form-field appearance="outline">
              <mat-label>Arrêt de départ</mat-label>
              <input matInput
                     placeholder="Chavant, Condillac Université, etc..."
                     formControlName="arret"
                     [matAutocomplete]="auto"
                     required>
              <mat-icon matSuffix style="cursor: pointer;">room</mat-icon>
              <mat-error *ngIf="checkError('arret', 'required')">L'arrêt doit être renseigné</mat-error>
              <mat-error *ngIf="checkError('arret', 'notfound')">L'arrêt na pas été trouvé</mat-error>
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelected($event)">
                <mat-option *ngIf="isLoading" class="is-loading">Chargement...</mat-option>
                <ng-container *ngIf="!isLoading">
                  <mat-option *ngFor="let stop of stops" [value]="stop.properties.name" [id]="stop.properties.id">
                    <span><b>{{stop.properties.name}}</b> ({{stop.properties.city}})</span>
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <!-- Duree du défi -->
          <div class="form-items">
            <p>Combien de temps estimes-tu nécessaire
              e pour effectuer ton défi (en minutes) ?</p>
            <mat-form-field appearance="outline">
              <mat-label> Durée du défi</mat-label>
              <input matInput placeholder="Durée du défi" formControlName="duree" type="number" name="duree" min="1"
                     required>
              <mat-error *ngIf="checkError('duree', 'required')">La durée doit être renseignée</mat-error>
              <mat-error *ngIf="checkError('duree', 'min')">La durée doit être d'une minute minimum</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- on peut faire une methode qui va calculer le nombre total des points à travers les etapes -->
        <!--      <p>Ton défi va nous faire gagner combien de points ? </p>
              <mat-form-field appearance="fill">
                <mat-label> Points du défi </mat-label>
                <input matInput placeholder="Total points " type="number" name="pointDefi" min="1" [(ngModel)]="totalPoints"
                       required>
                <mat-error *ngIf="checkError('pointDefi', 'requiered')">Le total de point doit être renseignée</mat-error>
              </mat-form-field>-->

        <!-- Tags -->

        <div class="form-items">
          <p>Sa aidera les autres chamis à retrouver ton defis</p>
          <mat-form-field appearance="outline">
            <mat-label>Mot-clés du défi</mat-label>
            <mat-chip-list #chipList aria-label="Mot Clés">
              <mat-chip *ngFor="let item of listeTags" selectable removable (removed)="remove(item)">
                {{item}}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            </mat-chip-list>
            <input pattern="[a-zA-Z ]*"
                   name="tags"
                   placeholder="Decouverte, StreetArt , etc..."
                   [matChipInputFor]="chipList"
                   [matChipInputSeparatorKeyCodes]="separatorKeysCodes" matChipInputAddOnBlur
                   (matChipInputTokenEnd)="add($event)">
          </mat-form-field>
        </div>
        <div class="form-items stepper-next-container">
          <button mat-button matStepperNext color="primary">Suivant</button>
        </div>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="secondFormGroup" errorMessage="Info des étapes non remplie en totalité">
    <ng-template matStepLabel>Les étapes du défi</ng-template>
    <div class="step-container">
      <div class="form-items">
        <p>Dans notre communauté, une étape peut être une indication ou une tache à faire ! Combien d'étapes contient ton défi ?</p>
        <!-- Creation des étapes -->
        <button mat-raised-button (click)="addEtape()" color="primary" class="stepper-next-container">Ajouter une étape</button>
      </div>
      <div class="form-items">
        <mat-accordion cdkDropList
                       *ngIf="getEtapesObservable() | async as etapes"
                       [cdkDropListData]="etapes"
                       (cdkDropListDropped)="drop($event)">
          <mat-expansion-panel
            cdkDrag
            *ngFor="let e of etapes;let num = index; trackBy: trackById">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon cdkDragHandle color="primary">
                  drag_handle
                </mat-icon>
                <span *ngIf="innerWidth<600;else titleFull">Etape {{num + 1}}</span>
                <ng-template #titleFull>
                  <span>Etape {{e.numero + 1}} : {{e.titre}}</span>
                </ng-template>
              </mat-panel-title>
              <mat-panel-description>
                <mat-error *ngIf="!e.isValide && innerWidth>=1080" style="margin-right: 10px">Attention, il y a des
                  erreurs dans cette étape
                </mat-error>
                <mat-icon color="warn" *ngIf="!e.isValide">error</mat-icon>
                <button mat-icon-button (click)="delete(e.numero)" *ngIf="etapes.length!==1">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div>
              <app-create-etape [etape]="e"></app-create-etape>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
      <div class="split-container stepper-next-container">
        <button mat-button matStepperPrevious color="primary">Retour</button>
        <button mat-button matStepperNext color="primary">Suivant</button>
      </div>
    </div>
  </mat-step>
  <mat-step>
    <form (ngSubmit)="openSnackBar()">
      <ng-template matStepLabel>On arrive à la fin !</ng-template>
      <!--<button mat-stroked-button (click)="openSnackBar(messageFi,action)">Créer mon défi</button>-->

      <br>
      <!-- Modification de ce qu'on a fait -->
      <div>
        <p class="TextModifierDefi"> Tu as changé d'avis ?</p>
        <p>Tu peux encore le modifier</p>
        <button mat-icon-button matStepperPrevious color="warn" aria-label="Example icon button with a home icon">
          Modifier le défi
          <mat-icon>update</mat-icon>
        </button>
      </div>

      <br>

      <div>
        <button mat-icon-button color="primary" aria-label="Example icon button with a home icon"
                [disabled]="firstFormGroup.invalid || firstFormGroup.pristine || secondFormGroup.invalid || secondFormGroup.pristine"
                type="submit">
          Créer le défi
          <mat-icon>task_alt</mat-icon>
        </button>
      </div>
    </form>
  </mat-step>
</mat-stepper>

